# Active Directory - Information gathering

**Summery:**

- [Active Directory - Information gathering](#active-directory---information-gathering)
  - [Domain Controller Information](#domain-controller-information)
  - [Get domain name](#get-domain-name)
  - [Information Logon Users](#information-logon-users)
  - [Command](#command)
    - [Remote](#remote)
  - [DC list](#dc-list)

## Domain Controller Information

Batch

```batch
netdom /query dc
```

Powershell

```powershell
Get-ADDomainController
```

fsmo roles

```powershell
Get-ADDomain | Select-Object InfrastructureMaster, RIDMaster, PDCEmulator
Get-ADForest | Select-Object DomainNamingMaster, SchemaMaster
```

```powershell
Get-ADDomainController -Filter * |
Select-Object Name, Domain, Forest, OperationMasterRoles |
Where-Object {$_.OperationMasterRoles} |
Format-Table -AutoSize
```

## Get domain name

```batch
wmic computersystem get domain
or
gpresult /R
```

## Information Logon Users

```powershell
NetWkstaUserEnum        # requires admin rights
NetSessionEnum
```

## Command  

```batch
net user \DOMAIN_NAME

dir \\IP_ADDRESSS\sysvol

copy \\IP_ADDRESSS\c$\temp\ntds.dit C:\temp
```

### Remote

Remote command  

```batch
wmic /node:dc /user:DOMAIN_NAME\USERNAME /password:PASSWORD process call create "cmd /c systeminfo"

runas.exe /netonly /user:DOMAIN_NAME\USERNAME cmd.exe
```

## DC list

```batch
nltest /dclist:DOMAIN_NAME
```
