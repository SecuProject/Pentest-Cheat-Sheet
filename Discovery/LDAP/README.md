# LDAP - 389

Default port: `389/tcp`

## Nmap 

> TOP 20

    nmap --script=ldap-search -p 389 TARGET_IP 

> DumpAll

    nmap --script=ldap-search TARGET_IP -p 389 --script-args ldap.maxobjects=-1 > ldapDump

> DumpUser
```bash
nmap --script=ldap-search TARGET_IP -p 389 --script-args ldap.maxobjects=-1 | grep "dn:" | grep "CN=Users" > ldapuser
```
> DumpAll with cread
```bash
ldapdomaindump -u 'DOMAIN\USERNAME' -p PASSWORD TARGET_IP -o ~/Documents/AD_DUMP/
```
## ldapsearch
```bash
ldapsearch -H ldap://IP_ADDRESS -p 389 -x -s base namingcontexts
ldapsearch -H ldap://IP_ADDRESS -p 389 -x -b "DC=DOMAIN,DC=LOCAL" '(objectClass=Person)'
ldapsearch -H ldap://IP_ADDRESS -p 389 -x -b "DC=DOMAIN,DC=LOCAL" '(objectClass=user)'
ldapsearch -H ldap://IP_ADDRESS -p 389 -x -b "DC=DOMAIN,DC=LOCAL" '(objectClass=User)' sAMAccountName | grep sAMAccountName | awk '{print $2}'> userLDAP.lst
```
### ldapsearch with authentification 
```bash
ldapsearch -H ldap://IP_ADDRESS -p 389 -x -b "DC=DOMAIN,DC=LOCAL" '(objectClass=user)' -D USERNAME@DOMAIN -w 'PASSWORD'
```

## LAPS 

### ldapsearch

```zsh
ldapsearch -x -H ldap://IP_ADDRESS -b "DC=DOMAIN,DC=LOCAL" '(objectClass=user)' | grep "ms-Mcs-AdmPwd:" -B 2
```

### CME

```
crackmapexec ldap 192.168.1.172 -u USERNAME -p PASSWORD â€“-kdcHost DOMAIN.LOCAL -M laps
```

## ADenum

git clone https://github.com/SecuProject/ADenum.git

> Install tool

    sudo apt-get install libsasl2-dev python-dev libldap2-dev libssl-dev
    pip3 install -r Requirement.txt
    
> Command

    ADenum.py -d DOMAIN.LOCAL
   
    ADenum.py -d DOMAIN.LOCAL -u USERNAME -p PASSWORD -j -ip IP_ADDRESS
