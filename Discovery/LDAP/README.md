# LDAP - 389

Default port: `389/tcp`

## Nmap

> TOP 20

```bash
nmap --script=ldap-search -p 389 TARGET_IP 
```

> DumpAll

```bash
nmap --script=ldap-search TARGET_IP -p 389 --script-args ldap.maxobjects=-1 > ldapDump
```

> DumpUser

```bash
nmap --script=ldap-search TARGET_IP -p 389 --script-args ldap.maxobjects=-1 | grep "dn:" | grep "CN=Users" > ldapuser
```

> DumpAll with credentials

```bash
ldapdomaindump -u 'DOMAIN\USERNAME' -p PASSWORD TARGET_IP -o ~/Documents/AD_DUMP/
```

## ldapsearch

```bash
ldapsearch -H ldap://IP_ADDRESS -x -s base namingcontexts
ldapsearch -H ldap://IP_ADDRESS -x -b "DC=DOMAIN,DC=LOCAL" '(objectClass=Person)'
ldapsearch -H ldap://IP_ADDRESS -x -b "DC=DOMAIN,DC=LOCAL" '(objectClass=user)'
ldapsearch -H ldap://IP_ADDRESS -x -b "DC=DOMAIN,DC=LOCAL" '(objectClass=User)' sAMAccountName | grep sAMAccountName | awk '{print $2}'> userLDAP.lst
```

### ldapsearch with authentication

```bash
ldapsearch -H ldap://IP_ADDRESS -x -b "DC=DOMAIN,DC=LOCAL" '(objectClass=user)' -D USERNAME@DOMAIN -w 'PASSWORD'
```

## LAPS

### ldapsearch

```bash
ldapsearch -x -H ldap://IP_ADDRESS -b "DC=DOMAIN,DC=LOCAL" "(ms-MCS-AdmPwd=*)" ms-MCS-AdmPwd
```

### CME

```bash
crackmapexec ldap 192.168.1.172 -u USERNAME -p PASSWORD â€“-kdcHost DOMAIN.LOCAL -M laps
```

## ADenum

git clone <https://github.com/SecuProject/ADenum.git>

> Install tool

```bash
sudo apt-get install libsasl2-dev python-dev libldap2-dev libssl-dev
pip3 install -r Requirement.txt
```

> Command

```bash
ADenum.py -d DOMAIN.LOCAL

ADenum.py -d DOMAIN.LOCAL -u USERNAME -p PASSWORD -j -ip IP_ADDRESS
```
