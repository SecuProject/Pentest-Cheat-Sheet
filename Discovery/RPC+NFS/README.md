# RPC

**RPCBind** default port: `111/tcp`

**RPCEnum** default port: `135/tcp,139/tcp,445/tcp`

## RPCBind (111)

```sh
rpcinfo â€“p TARGET_IP
rpcinfo DOMAIN_NAME
```

```sh
nfs-utils
```

```sh
nmap -p 111 --script=rpcinfo TARGET_IP
nmap -p 111 --script=nfs-* TARGET_IP
```

### Mount NFS share

```sh
sudo mkdir -p /mnt/nfs
sudo mount -o nolock TARGET_IP:/share /mnt/nfs
```

> If require authentication use:

```sh
sudo mount -o nolock,username=USERNAME,password=PASSWORD TARGET_IP:/share /mnt/nfs
```

> **Note:**

If the access to a file is denied, and the file as a owner such: `1004:1004`

```sh
sudo useradd -u 1004 nfsUser
su - nfsUser
```

## RPC Enumeration (139/445)

> rpcclient

```sh
rpcclient -U "" -N TARGET_IP
rpcclient -U "guest" -N TARGET_IP
rpcclient -U "" -N TARGET_IP -c getdompwinfo
```

> Look up sid

```sh
lookupsid.py 'Domain/Username:PASSWORD@IP_ADDRESS'
```

> Dump all

```sh
rpcdump.py 'Domain/Username:PASSWORD@IP_ADDRESS'
```

> Dump user

```sh
rpcclient -U "" -N TARGET_IP -c enumdomusers | awk -F '[][]' '{print $2}' > userRpc
```

> Interaction

Server info

```sh
rpc> srvinfo
```

RPC enum users

```rpc
rpc> enumdomusers

    user:[Guest] rid:[0x1f5]
    user:[AAD_987d7f2f57d2] rid:[0x450]
```

RPC enum users + Name

```rpc
rpc> querydispinfo
```

RPC enum group

```rpc
rpc> enumdomgroups

    group:[Domain Users] rid:[0x201]
    group:[Domain Guests] rid:[0x202]
    group:[Domain Computers] rid:[0x203]

rpc> querygroup 0x201

    Group Name:	Domain Users
    Description:
    Group Attribute:7
    Num Members:11

rpc> querygroupmem 0x44f

    rid:[0x451] attr:[0x7]

rpc> queryuser 0x451

    User Name   :	ryan
    Full Name   :	Ryan Bertrand

rpc> getusrdompwinfo 0x451
```

RPC enum password

```rpc
rpc> getdompwinfo
```
